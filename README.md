# Инструмент командной строки для учебного конфигурационного языка (Вариант №1)

Данный проект представляет собой инструмент командной строки, разработанный в рамках домашнего задания по дисциплине "Конфигурационное управление" (ИКБО-62-24, РТУ МИРЭА).

Инструмент выполняет трансляцию текста с учебного конфигурационного языка во входном формате в формат JSON.

## 1. Общее описание

Инструмент реализован на языке Python с использованием библиотеки **ANTLR4** для синтаксического анализа.

**Входной формат:**
*   Текст на учебном конфигурационном языке.
*   Принимается из **стандартного ввода (stdin)**.

**Выходной формат:**
*   Текст в формате **JSON**.
*   Выводится в **стандартный вывод (stdout)**.

Инструмент поддерживает:
1.  **Базовые структуры данных:** числа (`\d*\.\d+`), массивы (`#(...)`), словари (`{...}`).
2.  **Однострочные комментарии:** начинаются с `;`.
3.  **Объявление констант:** `const ИМЯ = значение`.
4.  **Вычисление константных выражений** на этапе трансляции: `$выражение$`.
5.  **Операции константных вычислений:** сложение (`+`), вычитание (`-`), функция `len()`.

## 2. Описание функций и настроек

### Грамматика языка

Синтаксический анализ реализован с помощью ANTLR4. Грамматика описана в файле `ConfigLang.g4`.

| Элемент | Синтаксис | Описание |
| :--- | :--- | :--- |
| **Числа** | `\d*\.\d+` | Числа с плавающей точкой (например, `12.34`, `.5`, `0.1`). |
| **Имена** | `[_A-Z][_a-zA-Z0-9]*` | Имена констант и ключей словарей. |
| **Массивы** | `#( значение, ... )` | Упорядоченный список значений. |
| **Словари** | `{ имя : значение, ... }` | Неупорядоченный набор пар ключ-значение. |
| **Комментарии** | `; ...` | Однострочные комментарии, игнорируются парсером. |
| **Объявление константы** | `const ИМЯ = значение` | Объявляет константу, доступную для использования в константных выражениях. |
| **Константное выражение** | `$выражение$` | Выражение, вычисляемое на этапе трансляции. |
| **Операции** | `+`, `-` | Сложение и вычитание чисел. |
| **Функции** | `len(аргумент)` | Возвращает размер массива или словаря. |

### Реализация (main.py)

Основная логика реализована в классе `ConfigLangEvaluator`, который наследуется от `ConfigLangVisitor` (сгенерирован ANTLR).

*   **`visitConstantDeclaration`**: Сохраняет вычисленное значение константы в словаре `self.constants`.
*   **`visitConstantExpression`**: Вычисляет выражение внутри `$...$` с использованием сохраненных констант.
*   **`visitSum`**: Рекурсивно вычисляет сумму и разность.
*   **`visitFunctionCall`**: Обрабатывает вызов `len()`, возвращая размер массива или словаря.
*   **`main`**: Настраивает ANTLR-парсер, использует кастомный `CustomErrorListener` для обработки синтаксических ошибок и выводит результат в JSON.

## 3. Описание команд для сборки проекта и запуска тестов

### Сборка проекта (генерация парсера)

Для работы проекта необходимо сгенерировать файлы парсера из грамматики `ConfigLang.g4`.

```bash
# Установка ANTLR Tool (требуется Java)
wget https://www.antlr.org/download/antlr-4.13.1-complete.jar -O antlr-4.13.1-complete.jar

# Генерация Python-кода парсера с поддержкой Visitor
java -jar antlr-4.13.1-complete.jar -Dlanguage=Python3 -visitor ConfigLang.g4
```

### Запуск инструмента

Инструмент `main.py` принимает входные данные через стандартный ввод.

```bash
# Установка зависимостей
pip3 install -r requirements.txt

# Запуск инструмента
cat <входной_файл_конфигурации> | python3 main.py > <выходной_файл_json>

# Пример запуска с тестовым файлом
cat config_examples.txt | python3 main.py
```

### Запуск тестов

Тесты реализованы в файле `test_parser.py` с использованием стандартного модуля `unittest`.

```bash
python3 test_parser.py
```

## 4. Примеры использования

Ниже приведены 3 примера конфигураций из разных предметных областей, а также их ожидаемый вывод в формате JSON.

### Пример 1: Конфигурация веб-сервера

**Входной текст (config_examples.txt):**

```
; --- Пример 1: Конфигурация веб-сервера (Nginx-подобная) ---
const MAX_WORKERS = 4.0
const CACHE_SIZE = 1024.0
const CACHE_ARRAY = #(1.0, 2.0, 3.0, 4.0, 5.0)
const CACHE_COUNT = $len(CACHE_ARRAY)$

{
    SERVER_CONFIG: {
        PORT: 80.0,
        WORKERS: $MAX_WORKERS$,
        TIMEOUT: 60.0,
        CACHE: {
            ENABLED: 1.0,
            SIZE_MB: $CACHE_SIZE$,
            SLOTS: $CACHE_COUNT$
        }
    },
    LOGGING: {
        LEVEL: 3.0,
        FILE_PATH: 1.0 ; Условное значение, так как нет строк
    }
}
```

**Выходной JSON:**

```json
{
    "SERVER_CONFIG": {
        "PORT": 80.0,
        "WORKERS": 4.0,
        "TIMEOUT": 60.0,
        "CACHE": {
            "ENABLED": 1.0,
            "SIZE_MB": 1024.0,
            "SLOTS": 5.0
        }
    },
    "LOGGING": {
        "LEVEL": 3.0,
        "FILE_PATH": 1.0
    }
}
```

### Пример 2: Конфигурация игрового персонажа

**Входной текст (config_examples.txt):**

```
; --- Пример 2: Конфигурация игрового персонажа ---
const BASE_HEALTH = 100.0
const BASE_ATTACK = 15.0
const INVENTORY_SLOTS = 5.0
const INVENTORY_ARRAY = #(1.0, 2.0, 3.0, 4.0, 5.0)
const INVENTORY_LEN = $len(INVENTORY_ARRAY)$

{
    PLAYER_STATS: {
        HEALTH: $BASE_HEALTH + 10.0$,
        ATTACK: $BASE_ATTACK$,
        DEFENSE: 5.0
    },
    INVENTORY: {
        SLOTS: $INVENTORY_SLOTS$,
        CURRENT_ITEMS: $INVENTORY_LEN - 2.0$
    },
    SKILLS: #(1.0, 2.0, 3.0)
}
```

**Выходной JSON:**

```json
{
    "PLAYER_STATS": {
        "HEALTH": 110.0,
        "ATTACK": 15.0,
        "DEFENSE": 5.0
    },
    "INVENTORY": {
        "SLOTS": 5.0,
        "CURRENT_ITEMS": 3.0
    },
    "SKILLS": [
        1.0,
        2.0,
        3.0
    ]
}
```

### Пример 3: Конфигурация базы данных

**Входной текст (config_examples.txt):**

```
; --- Пример 3: Конфигурация базы данных ---
const MAX_CONNECTIONS = 50.0
const TIMEOUT_SECONDS = 30.0
const POOL_CONFIG = {
    MAX: $MAX_CONNECTIONS$,
    MIN: 5.0
}
const POOL_SIZE = $len(POOL_CONFIG)$

{
    DATABASE: {
        HOST: 1.0, ; Условное значение
        PORT: 5432.0,
        POOL: $POOL_CONFIG$,
        TIMEOUT: $TIMEOUT_SECONDS$
    },
    MIGRATIONS: {
        ENABLED: 1.0,
        VERSION: 2.0
    },
    POOL_INFO: {
        SIZE_CHECK: $POOL_SIZE$
    }
}
```

**Выходной JSON:**

```json
{
    "DATABASE": {
        "HOST": 1.0,
        "PORT": 5432.0,
        "POOL": {
            "MAX": 50.0,
            "MIN": 5.0
        },
        "TIMEOUT": 30.0
    },
    "MIGRATIONS": {
        "ENABLED": 1.0,
        "VERSION": 2.0
    },
    "POOL_INFO": {
        "SIZE_CHECK": 2.0
    }
}
```
